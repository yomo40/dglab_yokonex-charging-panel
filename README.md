# è‚Œè‚‰ç”µåˆºæ¿€æŠ€æœ¯è®¾å¤‡é€‚é…é¢æ¿

âš¡ å……ç”µå®é¢æ¿ - æ”¯æŒ DG-LAB(éƒŠç‹¼) å’Œ å½¹æ¬¡å…ƒ è®¾å¤‡çš„æ§åˆ¶ä¸ç®¡ç†ã€‚
![Version](https://img.shields.io/badge/version-0.95.0-blue)
![License](https://img.shields.io/badge/license-GPLv3-blue)

## ç‰ˆæœ¬ 0.95.0

### ğŸ†• æ–°åŠŸèƒ½
- âœ… **å†…ç½®éƒŠç‹¼WebSocketæœåŠ¡å™¨**: æ— éœ€å¤–éƒ¨ä¸­è½¬æœåŠ¡ï¼Œå¯ç›´æ¥åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¯åŠ¨
- âœ… **OCRè¡€é‡è¯†åˆ«å¢å¼º**: æ”¯æŒä¸‰ç§è¯†åˆ«æ¨¡å¼ï¼ˆè¡€æ¡è¯†åˆ«ã€æ•°å­—OCRã€è‡ªåŠ¨æ£€æµ‹ï¼‰
- âœ… **æŠ¤ç”²è¯†åˆ«**: æ–°å¢æŠ¤ç”²æ¡è¯†åˆ«åŠŸèƒ½ï¼Œæ”¯æŒç‹¬ç«‹åŒºåŸŸæ¡†é€‰
- âœ… **é€æ˜çª—å£åŒºåŸŸé€‰æ‹©å™¨**: Electron é›†æˆçš„å±å¹•åŒºåŸŸæ‹¾å–å·¥å…·
- âœ… **ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒ**: æœ€å°åŒ–åˆ°æ‰˜ç›˜ï¼Œåå°è¿è¡Œ

## åŠŸèƒ½ç‰¹æ€§

- âœ… **ç»Ÿä¸€æ¥å£**: ä¸ºä¸åŒå‚å•†è®¾å¤‡æä¾›ç»Ÿä¸€çš„æ§åˆ¶æ¥å£
- âœ… **DG-LAB æ”¯æŒ**: é€šè¿‡ WebSocket åè®®è¿æ¥éƒŠç‹¼è®¾å¤‡
- âœ… **å½¹æ¬¡å…ƒ æ”¯æŒ**: é€šè¿‡è…¾è®¯ IM åè®®è¿æ¥å½¹æ¬¡å…ƒè®¾å¤‡
- âœ… **å†…ç½®WebSocketæœåŠ¡å™¨**: éƒŠç‹¼è®¾å¤‡å¯ç›´æ¥è¿æ¥ï¼Œæ— éœ€å¤–éƒ¨ä¸­è½¬
- âœ… **OCRè¡€é‡è¯†åˆ«**: æ”¯æŒè¡€æ¡é¢œè‰²è¯†åˆ«ã€æ•°å­—OCRå’Œè‡ªåŠ¨æ£€æµ‹
- âœ… **æŠ¤ç”²è¯†åˆ«**: ç‹¬ç«‹çš„æŠ¤ç”²æ¡è¯†åˆ«å’Œäº‹ä»¶è§¦å‘
- âœ… **REST API**: æä¾›å®Œæ•´çš„ HTTP API ç”¨äºè®¾å¤‡æ§åˆ¶
- âœ… **WebSocket API**: å®æ—¶åŒå‘é€šä¿¡æ”¯æŒ
- âœ… **æ³¢å½¢ç”Ÿæˆå™¨**: å†…ç½®å¤šç§é¢„è®¾æ³¢å½¢å’Œè‡ªå®šä¹‰æ³¢å½¢ç”Ÿæˆ
- âœ… **äº‹ä»¶è°ƒåº¦**: æ”¯æŒå®šæ—¶ä»»åŠ¡å’Œå‘¨æœŸæ€§ä»»åŠ¡
- âœ… **é…ç½®ç®¡ç†**: æŒä¹…åŒ–é…ç½®å­˜å‚¨
- âœ… **Electron æ¡Œé¢åº”ç”¨**: ç‹¬ç«‹è¿è¡Œçš„æ¡Œé¢å®¢æˆ·ç«¯

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œå‘è¡Œç‰ˆ

1. ä¸‹è½½ `å……ç”µå®2åˆ1å·¥å…·-v0.95.zip`
2. è¿è¡Œ `å……ç”µå®2åˆ1å·¥å…·.exe`

### æ–¹å¼äºŒï¼šä»æºç è¿è¡Œ

#### å®‰è£…ä¾èµ–

```bash
cd app
npm install
```

#### å¼€å‘æ¨¡å¼è¿è¡Œ

```bash
npm run dev
```

#### ç”Ÿäº§æ„å»º

```bash
npm run build
npm start
```

#### å¯åŠ¨ Electron åº”ç”¨

```bash
npm run build
npm run electron
```

## é¡¹ç›®ç»“æ„

```
app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ adapters/           # è®¾å¤‡é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ IDeviceAdapter.ts   # ç»Ÿä¸€æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ dglab/              # DG-LAB é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DGLabAdapter.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ protocol.ts     # åè®®ç¼–è§£ç 
â”‚   â”‚   â”‚   â””â”€â”€ waveform.ts     # æ³¢å½¢ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ yokonex/            # YOKONEX é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ YokonexAdapter.ts
â”‚   â”‚       â””â”€â”€ eventMapper.ts  # äº‹ä»¶æ˜ å°„
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ DeviceManager.ts    # è®¾å¤‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ EventScheduler.ts   # äº‹ä»¶è°ƒåº¦
â”‚   â”‚   â”œâ”€â”€ ConfigStore.ts      # é…ç½®å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ CoyoteWebSocketServer.ts  # å†…ç½®éƒŠç‹¼WebSocketæœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ OCRService.ts       # OCRè¡€é‡è¯†åˆ«æœåŠ¡
â”‚   â”œâ”€â”€ api/                # API å±‚
â”‚   â”‚   â”œâ”€â”€ server.ts           # HTTP/WS æœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ routes/             # è·¯ç”±å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ devices.ts      # è®¾å¤‡è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ control.ts      # æ§åˆ¶è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ events.ts       # äº‹ä»¶è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ ocr.ts          # OCRè·¯ç”±
â”‚   â”‚       â””â”€â”€ coyote.ts       # éƒŠç‹¼æœåŠ¡å™¨è·¯ç”±
â”‚   â”œâ”€â”€ utils/              # å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ logger.ts           # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ index.ts            # åº”ç”¨å…¥å£
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.json        # é»˜è®¤é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

## API æ–‡æ¡£

### éƒŠç‹¼WebSocketæœåŠ¡å™¨ç®¡ç†

#### è·å–æœåŠ¡å™¨çŠ¶æ€
```http
GET /api/coyote/status
```

#### å¯åŠ¨æœåŠ¡å™¨
```http
POST /api/coyote/start
Content-Type: application/json

{
  "port": 9999,
  "host": "0.0.0.0"
}
```

#### åœæ­¢æœåŠ¡å™¨
```http
POST /api/coyote/stop
```

### OCRè¡€é‡è¯†åˆ«

#### è·å–OCRçŠ¶æ€
```http
GET /api/ocr/status
```

#### é…ç½®OCR
```http
POST /api/ocr/configure
Content-Type: application/json

{
  "mode": "healthbar",
  "interval": 2000,
  "healthbar": {
    "color": "auto",
    "tolerance": 30
  }
}
```

#### è¯†åˆ«å›¾åƒ
```http
POST /api/ocr/recognize
Content-Type: application/json

{
  "image": "data:image/png;base64,..."
}
```

#### æ‰‹åŠ¨ä¸ŠæŠ¥è¡€é‡
```http
POST /api/ocr/report-blood
Content-Type: application/json

{
  "value": 75
}
```

### è®¾å¤‡ç®¡ç†

#### è·å–æ‰€æœ‰è®¾å¤‡
```http
GET /api/devices
```

#### æ·»åŠ è®¾å¤‡
```http
POST /api/devices
Content-Type: application/json

{
  "type": "dglab",
  "name": "My DG-LAB Device",
  "config": {
    "websocketUrl": "ws://localhost:9999",
    "autoReconnect": true
  }
}
```

#### è¿æ¥è®¾å¤‡
```http
POST /api/devices/:id/connect
```

#### æ–­å¼€è®¾å¤‡
```http
POST /api/devices/:id/disconnect
```

### è®¾å¤‡æ§åˆ¶

#### è®¾ç½®å¼ºåº¦
```http
POST /api/control/strength
Content-Type: application/json

{
  "deviceId": "device_1",
  "channel": 1,
  "value": 50,
  "mode": 2
}
```

å‚æ•°è¯´æ˜:
- `channel`: 1 = Aé€šé“, 2 = Bé€šé“
- `mode`: 0 = å‡å°‘, 1 = å¢åŠ , 2 = è®¾å®šå€¼
- `value`: å¼ºåº¦å€¼ (0-200)

#### å‘é€æ³¢å½¢
```http
POST /api/control/waveform
Content-Type: application/json

{
  "deviceId": "device_1",
  "channel": 1,
  "waveform": {
    "frequency": [50, 60, 70, 80],
    "strength": [20, 30, 40, 50],
    "duration": 1
  }
}
```

#### ä½¿ç”¨é¢„è®¾æ³¢å½¢
```http
POST /api/control/waveform/preset
Content-Type: application/json

{
  "deviceId": "device_1",
  "channel": 1,
  "preset": "pulse",
  "duration": 2
}
```

å¯ç”¨é¢„è®¾: `gentle`, `pulse`, `wave`, `intense`, `random`

#### å‘é€äº‹ä»¶ (YOKONEX)
```http
POST /api/control/event
Content-Type: application/json

{
  "deviceId": "device_1",
  "eventId": "hurt",
  "payload": {}
}
```

#### ç´§æ€¥åœæ­¢
```http
POST /api/control/stop
```

### WebSocket API

è¿æ¥åˆ° `ws://localhost:3000` åå‘é€ JSON æ¶ˆæ¯:

#### è®¢é˜…äº‹ä»¶
```json
{
  "type": "subscribe",
  "events": ["device.status", "device.strength"]
}
```

#### å‘é€å‘½ä»¤
```json
{
  "type": "command",
  "command": "setStrength",
  "params": {
    "deviceId": "device_1",
    "channel": 1,
    "value": 30
  }
}
```

## é…ç½®è¯´æ˜

ç¼–è¾‘ `config/default.json`:

```json
{
  "server": {
    "port": 3000,
    "host": "0.0.0.0"
  },
  "dglab": {
    "websocketUrl": "ws://localhost:9999",
    "heartbeatInterval": 10000,
    "reconnectInterval": 5000
  },
  "yokonex": {
    "apiBase": "https://suo.jiushu1234.com/api.php",
    "imTimeout": 15000
  },
  "waveform": {
    "defaultFrequency": 50,
    "defaultStrength": 20
  },
  "logging": {
    "level": "info"
  }
}
```

## ä½¿ç”¨ç¤ºä¾‹

### DG-LAB è®¾å¤‡è¿æ¥

```javascript
// 1. æ·»åŠ è®¾å¤‡
const response = await fetch('http://localhost:3000/api/devices', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    type: 'dglab',
    name: 'My Coyote',
    config: {
      websocketUrl: 'ws://your-ws-server:9999',
      autoReconnect: true
    }
  })
});
const { data: device } = await response.json();

// 2. è¿æ¥è®¾å¤‡
await fetch(`http://localhost:3000/api/devices/${device.id}/connect`, {
  method: 'POST'
});

// 3. è®¾ç½®å¼ºåº¦
await fetch('http://localhost:3000/api/control/strength', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    deviceId: device.id,
    channel: 1,
    value: 30,
    mode: 2
  })
});
```

### YOKONEX è®¾å¤‡è¿æ¥

```javascript
// 1. æ·»åŠ è®¾å¤‡
const response = await fetch('http://localhost:3000/api/devices', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    type: 'yokonex',
    name: 'My YCY Device',
    config: {
      uid: '12345',
      token: 'your-token-here'
    }
  })
});
const { data: device } = await response.json();

// 2. è¿æ¥è®¾å¤‡
await fetch(`http://localhost:3000/api/devices/${device.id}/connect`, {
  method: 'POST'
});

// 3. å‘é€äº‹ä»¶
await fetch('http://localhost:3000/api/control/event', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    deviceId: device.id,
    eventId: 'hurt'
  })
});
```

## è®¸å¯è¯
- æœ¬é¡¹ç›®é‡‡ç”¨ GNU GPL v3.0ï¼ˆè¯¦è§ [LICENSE](LICENSE)ï¼‰ã€‚
- å…è®¸å•†ç”¨ï¼Œä½†éœ€å…¬å¼€å®Œæ•´æºä»£ç ï¼Œå¹¶åœ¨ç›¸åŒåè®®ä¸‹åˆ†å‘ã€‚
- æ‰€æœ‰ä¿®æ”¹å’Œå†åˆ†å‘ç‰ˆæœ¬å¿…é¡»é™„å¸¦æºç ä¸ç‰ˆæƒå£°æ˜ã€‚

## å¼€å‘è€…

- [yomo40](https://github.com/yomo40)

## è‡´è°¢

- [DG-LAB](https://github.com/DG-LAB-OPENSOURCE) - éƒŠç‹¼è®¾å¤‡åè®®
- [YCY-YOKONEX-OpenSource](https://github.com/YCY-YOKONEX/YCY-YOKONEX-OpenSource) - å½¹æ¬¡å…ƒè®¾å¤‡åè®®