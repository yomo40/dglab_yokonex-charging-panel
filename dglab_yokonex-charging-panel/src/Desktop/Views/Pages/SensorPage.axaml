<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ChargingPanel.Desktop.Views.Pages.SensorPage">
    
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- 标题栏 -->
        <Border Grid.Row="0" Padding="20" CornerRadius="16" Margin="0,0,0,16" BoxShadow="0 4 16 0 #10000000">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Offset="0" Color="#1F2B3E" />
                    <GradientStop Offset="1" Color="#24324A" />
                </LinearGradientBrush>
            </Border.Background>
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Border Background="#14B8A620" CornerRadius="10" Padding="10">
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="传感器配置" FontSize="18" FontWeight="Bold" Foreground="White"/>
                        <TextBlock Text="配置役次元传感器的触发规则" FontSize="12" Foreground="#9AB0C8" Margin="0,4,0,0"/>
                    </StackPanel>
                </StackPanel>
                <Button Grid.Column="1" Click="OnScanSensors" Padding="16,10" CornerRadius="10" FontWeight="SemiBold">
                    <Button.Background>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                            <GradientStop Offset="0" Color="#14B8A6" />
                            <GradientStop Offset="1" Color="#22d3ee" />
                        </LinearGradientBrush>
                    </Button.Background>
                    <TextBlock Text="扫描传感器" Foreground="White" />
                </Button>
            </Grid>
        </Border>
        
        <!-- 主内容区 -->
        <Grid Grid.Row="1" ColumnDefinitions="300,*" Margin="0">
            <!-- 左侧：传感器列表 -->
            <Border CornerRadius="16" Padding="16" BoxShadow="0 4 16 0 #10000000">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Offset="0" Color="#1F2B3E" />
                        <GradientStop Offset="1" Color="#24324A" />
                    </LinearGradientBrush>
                </Border.Background>
                <Grid RowDefinitions="Auto,*">
                    <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,16">
                        <Border Background="#10B98120" CornerRadius="8" Padding="8">
                        </Border>
                        <TextBlock Text="已连接传感器" FontWeight="Bold" Foreground="White" FontSize="14" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <ListBox Grid.Row="1" x:Name="SensorList" Background="Transparent"
                             SelectionChanged="OnSensorSelected">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#3C3C3C" CornerRadius="6" Padding="12" Margin="0,4">
                                    <Grid RowDefinitions="Auto,Auto,Auto">
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="10" Height="10" Fill="{Binding StatusColor}" Margin="0,0,8,0"/>
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="White"/>
                                        </StackPanel>
                                        <TextBlock Grid.Row="1" Text="{Binding TypeName}" FontSize="11" Foreground="#888" Margin="18,4,0,0"/>
                                        <TextBlock Grid.Row="2" Text="{Binding StatusText}" FontSize="11" Foreground="#666" Margin="18,2,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
            
            <!-- 右侧：配置面板 -->
            <ScrollViewer Grid.Column="1" Margin="16,0,0,0">
                <Grid>
                    <StackPanel x:Name="ConfigPanel" IsVisible="False">
                        <!-- 传感器信息 -->
                        <Border CornerRadius="16" Padding="18" Margin="0,0,0,16" BoxShadow="0 4 16 0 #10000000">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                    <GradientStop Offset="0" Color="#1F2B3E" />
                                    <GradientStop Offset="1" Color="#24324A" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,12">
                                    <Border Background="#0EA5E920" CornerRadius="8" Padding="8">
                                        <TextBlock Text="信息" FontSize="12" VerticalAlignment="Center" />
                                    </Border>
                                    <TextBlock Text="传感器信息" FontWeight="Bold" Foreground="White" FontSize="14" VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <Grid Grid.Row="1" ColumnDefinitions="100,*" Margin="0,8,0,0">
                                    <TextBlock Text="名称:" Foreground="#9AB0C8"/>
                                    <TextBox Grid.Column="1" x:Name="SensorNameInput" Background="#172033" Foreground="White" CornerRadius="8" Padding="10,8"/>
                                </Grid>
                                
                                <Grid Grid.Row="2" ColumnDefinitions="100,*" Margin="0,8,0,0">
                                    <TextBlock Text="类型:" Foreground="#9AB0C8"/>
                                    <TextBlock Grid.Column="1" x:Name="SensorTypeText" Foreground="White"/>
                                </Grid>
                                
                                <Grid Grid.Row="3" ColumnDefinitions="100,*" Margin="0,8,0,0">
                                    <TextBlock Text="状态:" Foreground="#9AB0C8"/>
                                    <TextBlock Grid.Column="1" x:Name="SensorStatusText" Foreground="#10B981"/>
                                </Grid>
                            </Grid>
                        </Border>
                        
                        <!-- 实时数据 -->
                        <Border CornerRadius="16" Padding="18" Margin="0,0,0,16" BoxShadow="0 4 16 0 #10000000">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                    <GradientStop Offset="0" Color="#1F2B3E" />
                                    <GradientStop Offset="1" Color="#24324A" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Grid RowDefinitions="Auto,Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,12">
                                    <Border Background="#10B98120" CornerRadius="8" Padding="8">
                                    </Border>
                                    <TextBlock Text="实时数据" FontWeight="Bold" Foreground="White" FontSize="14" VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <Grid Grid.Row="1" ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" Margin="0,8,0,0">
                                    <!-- 役次元传感器数据 -->
                                    <StackPanel x:Name="YokonexSensorData" Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                                        <TextBlock Text="步数" Foreground="#9AB0C8" FontSize="11"/>
                                        <Border Background="#0EA5E9" CornerRadius="8" Padding="12,6" Margin="0,6,0,0" HorizontalAlignment="Left">
                                            <TextBlock x:Name="StepCountText" Text="0" Foreground="White" FontSize="18" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="1" x:Name="AngleData" Margin="8,0,0,8">
                                        <TextBlock Text="角度" Foreground="#9AB0C8" FontSize="11"/>
                                        <Border Background="#0EA5E9" CornerRadius="8" Padding="12,6" Margin="0,6,0,0" HorizontalAlignment="Left">
                                            <TextBlock x:Name="AngleText" Text="X:0° Y:0° Z:0°" Foreground="White" FontSize="16" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Grid.Column="0" x:Name="PressureData" Margin="0,8,8,0" IsVisible="False">
                                        <TextBlock Text="压力 (A/B)" Foreground="#9AB0C8" FontSize="11"/>
                                        <Border Background="#10B981" CornerRadius="8" Padding="12,6" Margin="0,6,0,0" HorizontalAlignment="Left">
                                            <TextBlock x:Name="PressureText" Text="A:0 / B:0" Foreground="White" FontSize="16" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Grid.Column="1" x:Name="ExternalVoltageData" Margin="8,8,0,0" IsVisible="False">
                                        <TextBlock Text="外部电压" Foreground="#9AB0C8" FontSize="11"/>
                                        <Border Background="#F59E0B" CornerRadius="8" Padding="12,6" Margin="0,6,0,0" HorizontalAlignment="Left">
                                            <TextBlock x:Name="ExternalVoltageText" Text="0.00V" Foreground="White" FontSize="16" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Border>
                        <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,16">
                            <Button x:Name="QuickRulePrimaryButton"
                                    Content="基于步数创建规则"
                                    Background="#0EA5E9"
                                    Foreground="White"
                                    Padding="14,8"
                                    CornerRadius="10"
                                    Click="OnQuickAddPrimaryRule" />
                            <Button x:Name="QuickRuleSecondaryButton"
                                    Content="基于角度创建规则"
                                    Background="#10B981"
                                    Foreground="White"
                                    Padding="14,8"
                                    CornerRadius="10"
                                    Click="OnQuickAddSecondaryRule" />
                        </StackPanel>
                        
                        <!-- 触发规则 -->
                        <Border CornerRadius="16" Padding="18" Margin="0,0,0,16" BoxShadow="0 4 16 0 #10000000">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                    <GradientStop Offset="0" Color="#1F2B3E" />
                                    <GradientStop Offset="1" Color="#24324A" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Grid RowDefinitions="Auto,Auto,*">
                                <Grid ColumnDefinitions="*,Auto">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <Border Background="#F59E0B20" CornerRadius="8" Padding="8">
                                        </Border>
                                        <TextBlock Text="触发规则" FontWeight="Bold" Foreground="White" FontSize="14" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <Button Grid.Column="1" Click="OnAddRule" Padding="14,8" CornerRadius="10" FontWeight="SemiBold">
                                        <Button.Background>
                                            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                                                <GradientStop Offset="0" Color="#0EA5E9" />
                                                <GradientStop Offset="1" Color="#22D3EE" />
                                            </LinearGradientBrush>
                                        </Button.Background>
                                        <TextBlock Text="+ 添加规则" Foreground="White" />
                                    </Button>
                                </Grid>
                                
                                <TextBlock Grid.Row="1" Text="配置传感器事件触发的设备动作" Foreground="#9AB0C8" FontSize="11" Margin="0,8,0,12"/>
                                
                                <ItemsControl Grid.Row="2" x:Name="RulesList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#3C3C3C" CornerRadius="6" Padding="12" Margin="0,4">
                                                <Grid ColumnDefinitions="*,Auto">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding TriggerTypeName}" FontWeight="SemiBold" Foreground="White"/>
                                                        <TextBlock Text="{Binding ActionDescription}" FontSize="11" Foreground="#888" Margin="0,4,0,0"/>
                                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                            <TextBlock Text="目标设备: " FontSize="11" Foreground="#666"/>
                                                            <TextBlock Text="{Binding TargetDeviceName}" FontSize="11" Foreground="#0078D4"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                                                        <ToggleSwitch IsChecked="{Binding IsEnabled}" OnContent="启用" OffContent="禁用"
                                                                      IsCheckedChanged="OnRuleToggleChanged"/>
                                                        <Button Background="Transparent" Foreground="#EF4444"
                                                                Padding="8,4" CornerRadius="4"
                                                                Click="OnDeleteRule" Tag="{Binding}">
                                                        </Button>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Grid>
                        </Border>
                        
                        <!-- 关联设备 -->
                        <Border CornerRadius="16" Padding="18" BoxShadow="0 4 16 0 #10000000">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                    <GradientStop Offset="0" Color="#1F2B3E" />
                                    <GradientStop Offset="1" Color="#24324A" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <Grid RowDefinitions="Auto,Auto,Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <Border Background="#14B8A620" CornerRadius="8" Padding="8">
                                    </Border>
                                    <TextBlock Text="关联电击器" FontWeight="Bold" Foreground="White" FontSize="14" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock Grid.Row="1" Text="选择传感器触发时控制的电击器设备" Foreground="#9AB0C8" FontSize="11" Margin="0,8,0,12"/>
                                
                                <ComboBox Grid.Row="2" x:Name="TargetDeviceCombo" Background="#172033" Foreground="White"
                                          SelectionChanged="OnTargetDeviceChanged" HorizontalAlignment="Stretch" CornerRadius="10">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </Grid>
                        </Border>
                    </StackPanel>
                    
                    <!-- 未选择传感器时的提示 -->
                    <Border x:Name="NoSelectionPanel" CornerRadius="16" Padding="40" 
                            HorizontalAlignment="Center" VerticalAlignment="Center" BoxShadow="0 4 16 0 #10000000">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                <GradientStop Offset="0" Color="#1F2B3E" />
                                <GradientStop Offset="1" Color="#24324A" />
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel HorizontalAlignment="Center">
                            <Border Background="#14B8A620" CornerRadius="20" Width="80" Height="80" HorizontalAlignment="Center">
                            </Border>
                            <TextBlock Text="请从左侧选择一个传感器" Foreground="#9AB0C8" FontSize="14" Margin="0,20,0,0" HorizontalAlignment="Center"/>
                            <TextBlock Text="或点击[扫描传感器]搜索新设备" Foreground="#8091A8" FontSize="12" Margin="0,8,0,0" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </ScrollViewer>
        </Grid>
        
        <!-- 底部状态栏 -->
        <Border Grid.Row="2" Padding="16,12" CornerRadius="16" Margin="0,16,0,0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                    <GradientStop Offset="0" Color="#0EA5E9" />
                    <GradientStop Offset="1" Color="#22D3EE" />
                </LinearGradientBrush>
            </Border.Background>
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock x:Name="StatusText" Text="就绪" Foreground="White" VerticalAlignment="Center" FontWeight="SemiBold"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="传感器: " Foreground="#E0E0E0"/>
                    <TextBlock x:Name="SensorCountText" Text="0" Foreground="White" FontWeight="Bold"/>
                    <TextBlock Text="| 规则: " Foreground="#E0E0E0" Margin="16,0,0,0"/>
                    <TextBlock x:Name="RuleCountText" Text="0" Foreground="White" FontWeight="Bold"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
    
</UserControl>




