# 用户关系模型

## 场景1: 远程控制

```
用户1 ──── 控制指令 ────→ 用户2
```

## 场景2: 游戏对战惩罚

```
用户3 (PC+设备) ←───── 房间对战 ──────→ 用户4 (PC+设备)
     ↓                                    ↓
  游戏失败                             游戏失败
     ↓                                    ↓
 接受电击惩罚                         接受电击惩罚
```

## 场景3: 多人房间

```
┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐
│用户A │  │用户B │  │用户C │  │用户D │
└──┬───┘  └──┬───┘  └──┬───┘  └──┬───┘
   └─────────┴─────────┴─────────┘
              房间
    (互相可见状态，可互相控制)
```



# GameAdapterPanel

**单一应用，多端适配**

## UI 层

- **Avalonia** (Windows/macOS/Linux)
- **MAUI** (Android/iOS)
- **Web** (预留)

## Core 核心层

### 设备模块

- 郊狼
- 役次元
- 扩展接口

### OCR模块

- 内置引擎
- 自定义模型
- 血条/数字识别

### 游戏适配模块

- 插件系统
- 规则引擎
- 脚本执行

### 网络模块

- P2P直连
- 房间系统
- 云端中转

### 数据模块

- SQLite
- 配置管理
- 日志系统

### 事件模块

- 本地事件
- 远程事件
- 事件同步


# 房间系统

## 创建房间

```
用户A ──创建房间──→ 生成房间码: ABC123
                  (可选: 设置密码/人数限制/权限)
```

## 加入房间

```
用户B ──输入房间码──→ 加入房间 ABC123
```

## 房间内通信

### 房间 ABC123

- **用户A**: PC+郊狼
- **用户B**: PC+役次元
- **用户C**: 手机(无设备)

### 房间状态同步

- **用户列表**: 谁在线/谁有设备
- **设备状态**: 连接/强度/模式
- **游戏状态**: 血量/护甲/死亡
- **控制权限**: 谁可以控制谁

## 连接方式

> **需要内置支持模式1**

### 模式1: P2P

- 房主开端口
- 直接连接
- 延迟最低

### 模式2: 中转

- 云服务器中转
- 无需开端口
- 穿透NAT

### 模式3: 混合

- 优先P2P
- 失败则中转
- 最佳体验


# 权限系统

## 用户角色

用户角色非固定，可切换：

### 控制者

- 可发送指令
- 可观看状态

### 被控者

- 接收指令
- 可拒绝控制

### 观察者

- 只能观看
- 不能操作

## 权限授予

```
用户A ──请求控制权限────→ 用户B
                           ↓
                    [同意] / [拒绝]
                           ↓
                  授权成功 / 授权失败
```

## 对战模式

### 游戏对战房间

**规则**: 游戏中死亡 → 触发对方设备电击

```
┌──────┐                      ┌──────┐
│用户A │  ←──── 互相绑定 ────→ │用户B │
│ 血量 │                      │ 血量 │
└──┬───┘                      └──┬───┘
   │                            │
   ↓ 死亡事件                   ↓ 死亡事件
触发用户B设备              触发用户A设备
```
